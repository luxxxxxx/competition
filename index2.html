<!DOCTYPE html>
<html lang="en">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1,user-scalable=no">
<head>
    <meta charset="UTF-8">
    <title>书及</title>
    <link rel="stylesheet" href="./css/reset.css">
    <link rel="stylesheet" href="./css/index2.css">
    <script type="text/javascript">
	!function(a,b){function c(){var b=f.getBoundingClientRect().width;b/i>540&&(b=540*i);var c=b/10;f.style.fontSize=c+"px",k.rem=a.rem=c}var d,e=a.document,f=e.documentElement,g=e.querySelector('meta[name="viewport"]'),h=e.querySelector('meta[name="flexible"]'),i=0,j=0,k=b.flexible||(b.flexible={});if(g){console.warn("将根据已有的meta标签来设置缩放比例");var l=g.getAttribute("content").match(/initial\-scale=([\d\.]+)/);l&&(j=parseFloat(l[1]),i=parseInt(1/j))}else if(h){var m=h.getAttribute("content");if(m){var n=m.match(/initial\-dpr=([\d\.]+)/),o=m.match(/maximum\-dpr=([\d\.]+)/);n&&(i=parseFloat(n[1]),j=parseFloat((1/i).toFixed(2))),o&&(i=parseFloat(o[1]),j=parseFloat((1/i).toFixed(2)))}}if(!i&&!j){var p=(a.navigator.appVersion.match(/android/gi),a.navigator.appVersion.match(/iphone/gi)),q=a.devicePixelRatio;i=p?q>=3&&(!i||i>=3)?3:q>=2&&(!i||i>=2)?2:1:1,j=1/i}if(f.setAttribute("data-dpr",i),!g)if(g=e.createElement("meta"),g.setAttribute("name","viewport"),g.setAttribute("content","initial-scale="+j+", maximum-scale="+j+", minimum-scale="+j+", user-scalable=no"),f.firstElementChild)f.firstElementChild.appendChild(g);else{var r=e.createElement("div");r.appendChild(g),e.write(r.innerHTML)}a.addEventListener("resize",function(){clearTimeout(d),d=setTimeout(c,300)},!1),a.addEventListener("pageshow",function(a){a.persisted&&(clearTimeout(d),d=setTimeout(c,300))},!1),"complete"===e.readyState?e.body.style.fontSize=12*i+"px":e.addEventListener("DOMContentLoaded",function(){e.body.style.fontSize=12*i+"px"},!1),c(),k.dpr=a.dpr=i,k.refreshRem=c,k.rem2px=function(a){var b=parseFloat(a)*this.rem;return"string"==typeof a&&a.match(/rem$/)&&(b+="px"),b},k.px2rem=function(a){var b=parseFloat(a)/this.rem;return"string"==typeof a&&a.match(/px$/)&&(b+="rem"),b}}(window,window.lib||(window.lib={}));
	</script>
</head>
<body>
	<div id="main">
		<div id="mask" class="pic">
			<div id="relative">
				<div class="showPics">
					<div class="arrow"></div>
					<div class="picSlider">
						<ul class="picCon clearfix">
						</ul>
					</div>
					<div class="addPics"></div>
				</div>
			</div>
		</div>  <!-- no：没有mask，pic：上传图片后显示图片，confirm：需要确认，success：成功-->
		<div class="article">  <!-- 一条说说 -->
			<div class="contentTitle">
				<div class="section clearfix">	
					<div class="photo"><img src="./img/main/tx.jpg" alt="用户头像"></div>
					<div class="rightCon clearfix">
					<div class="top clearfix">
						<div class="nameTag">
							<div class="name"><span>老司机 1 号<i class="crown"></i></span></div>
							<div class="date">2017-02-05 10:48:37</div>
						</div>
						<div class="star favor"></div> <!-- favor 收藏-->
					</div>
					<div class="t clearfix">
						<span class="bookName">
							单片机从入门到放弃单片机从入门到放弃
						</span>
						<span class="bookType">
							【教材】
						</span>
						<span class="sellType">
							租聘
						</span>
					</div>
					<div class="article clearfix">
						<div class="borrowCon">
							<div class="l">
								<p>告诉对方公司</p>
								<span class="date">出租时间: 2017-02-06~2017-02-06</span>
							</div>
							<div class="borrow">借阅</div>
						</div>
					</div>
					<div class="footer clearfix">
						<div class="l">
							<span class="text">浏览量</span>
							<span class="num">999</span>
						</div>
						<div class="r">
							<span class="num">999</span>
							<span class="text">条评论</span>
						</div>
					</div>
					</div>
				</div>
			</div>
			<div class="responseCon" class="clearfix">
				<div class="section clearfix">
					<div class="user clearfix">
						<div class="photo">
							<img src="./img/main/tx.jpg" alt="用户头像">
						</div>
						<div class="rightCon clearfix">
						<div class="top clearfix">
							<div class="nameTag">
								<div class="name"><span>老司机 1 号<i class="crown"></i></span></div>
								<div class="date">2017-02-05 10:48:37</div>
							</div>
							<div class="thumbCon clearfix">
								<i class="thumb"></i>
								<span class="num">666</span>
							</div>
						</div>
						<div class="response clearfix">
							<p>回复</p>
							<div class="imgCon clearfix">
								<div class="img">
									<img src="./img/main/tx.jpg" alt="上传图片">
								</div>
								<div class="img">
									<img src="./img/main/tx.jpg" alt="上传图片">
								</div>
								<div class="img">
									<img src="./img/main/tx.jpg" alt="上传图片">
								</div>
							</div>
						</div>
					</div>
					<!-- <div class="line" style="width: 100%;height: 1px; background:  blue;"></div> -->
					</div>
					<div class="user clearfix">
						<div class="photo">
							<img src="./img/main/tx.jpg" alt="用户头像">
						</div>
						<div class="rightCon clearfix">
							<div class="top clearfix">
								<div class="nameTag">
									<div class="name"><span>老司机 1 号<i class="crown"></i></span></div>
									<div class="date">2017-02-05 10:48:37</div>
								</div>
								<div class="thumbCon clearfix">
									<i class="thumb"></i>
									<span class="num">666</span>
								</div>
							</div>
							<div class="response">
								<p>回复</p>
								<div class="imgCon clearfix">
									<div class="img">
										<img src="./img/main/tx.jpg" alt="上传图片">
									</div>
									<div class="img">
										<img src="./img/main/tx.jpg" alt="上传图片">
									</div>
									<div class="img">
										<img src="./img/main/tx.jpg" alt="上传图片">
									</div>
								</div>
							</div>
						</div>
					</div>
					<div class="user clearfix">
						<div class="comment">
							<span class="u">老司机一号</span>：回复&nbsp;<span class="u">老司机二号</span>：你说的很有道理
						</div>
					</div>

				</div>
			</div>
		</div>

	</div>
</div>  <!-- ???? -->
</div>
<div id="comment">
	<div class="middle clearfix">
		<div class="pic"></div>
		<textarea name="" id="inputText" cols="30" rows="10"></textarea>
		<div id="sendBtn">发送</div>
		<input type="file" accept="image/*" multiple="multiple" id="inputFile" style="display: none;">
	</div>
</div>
</body>
</html>
<script src="./js/jqq.js"></script>
<script>
	// $("#main").css("width", window.innerWidth +"px");
	// $("#comment").css("width", window.innerWidth +"px");
	var $addPics = $('#relative > div > div.addPics'),  //添加图片按钮
		$inputFile = $('#inputFile'),
		$mask = $('#mask'),
		$picBtn = $('#comment > div > div.pic'),  //发送图片按钮
		picsUrlArr = [],  //存放图片链接数组  (最大上传三张图片)
		$sendBtn = $('#sendBtn'),
		$picsBox = $('#relative > div > div.picSlider > ul'),
		addPicsFlag = false;  //添加图片flag 

	$picBtn.click (function () {
		$mask[0].className = 'pic';
	})
	$inputFile.bind('change',function(){
		picsUrlArr = [];
		var file = this.files,
			reader = new FileReader (),
			loopNum = file.length < 3 ? file.length : 3;  //最大上传三张图片
			
		$picsBox.html('');
		for (let i = 0; i < loopNum; i++) {
			let imgObj = {};
			let reader = new FileReader();
			reader.readAsDataURL(file[i]);
			reader.onload = function (e) {
				var resultURL = e.target.result;
				var oImg = document.createElement('img');
				oImg.src = resultURL;
				var cvs = document.createElement('canvas');
				oImg.onload  = function () {
					cvs.width = 500;
					cvs.height = 500;
					let ctx = cvs.getContext('2d');
					ctx.drawImage(this,0,0,cvs.width,cvs.height);
					newImageData = cvs.toDataURL(file[i],0.5);
					var oLi = document.createElement('li'),
						oI = document.createElement('i'),
						Img = document.createElement('img');
					Img.src = newImageData;
					imgObj = {i:newImageData};
					oLi.className = 'pic';
					oI.className = 'delete';
					oI.index = i;
					oI.onclick = function () {
						$(this).parent().remove();
					}
					oLi.setAttribute('base64',newImageData);
					oLi.appendChild(Img);
					oLi.appendChild(oI);
					$picsBox[0].appendChild(oLi);
				}
			}
			picsUrlArr.push(imgObj);
		}
		addPicsFlag = false;  //结束后又可以继续点击  防止连续重复多次点击

	});
	$addPics.click(function(){  //选择图片点击
		if (!addPicsFlag) {
			addPicsFlag = true;
			$inputFile.click();
		}
	});

	$sendBtn.click(function () {
		var pics = $picsBox[0].querySelectorAll('li.pic');
		for (var i = 0; i < pics.length; i++) {
			console.log(pics[i].getAttribute('base64'))
		}
	})

	// var $inputFile = $("#inputFile");
	// $("#comment .pic").click(function () { 
	// 	$("#mask").setClass("pic");
	// })
	// $("#mask > div > div.addPics").click(function () { //点击图片
	// 	$inputFile.click();
	// })
	// $inputFile.bind('change',function(){  //监听file改变
	// 	$("#mask > div > div.picSlider > ul").html('');
	// 	var file = this.files,
	// 		reader = new FileReader(),
	// 		picsBase = [],
	// 		reader = new FileReader(),
	// 	    loopNum = Math.min(file.length,2);
	// 	for (var i = 0; i < loopNum; i++) {
	// 		var file = this.files,
	// 			reader = new FileReader(),
	// 		    oLi = document.createElement('li'),
	// 		    oImg = document.createElement('img'),
	// 		    oI = document.createElement('oI'),
	// 		    cvs = document.createElement('canvas');
	// 	    oI.className = 'delete';
	// 	    oI.onclick = function () {
	// 	    	$(this).parent().remove();
	// 	    }
	// 	    oLi.appendChild(oI);
	// 		reader.onload = function () {
	// 			cvs.width = 500;
	// 			cvs.height = 500;
	// 			var ctx = cvs.getContext('2d');
	// 			ctx.drawImage(this,0,0,cvs.width,cvs.height);
	// 			newImageData = cvs.toDataURL(file[i],0.5);
	// 			oImg.src = newImageData;
	// 			oLi.appendChild(oImg);
	// 			oLi.className = 'pic';
	// 			$("#mask > div > div.picSlider > ul")[0].appendChild(oLi);
	// 		}
	// 	}

	// })

	//<li class="pic">
//						<img src="./img/main/tx.jpg" alt="用户头像" />
//						<i class="delete"></i>
//					</li>
	$('.delete').bind('click',function(){deletePic.call(this)}) 
	function deletePic () {
		$(this).parent().remove();
	}
	$("#mask").bind("touchstart",function (e) {  //触摸屏幕退回之前选择图片前
		var e = e || window.evnet;
		if (e.target === this) {
			this.className = 'no';
		}
	})



</script>
